# 计算机网络

2024年9月8日 叶茂林

### 网络模型

应用层（表示层、会话层）：HTTP（80）、DNS（53）、FTP（20、21）、SSH（22）、HTTPS（443）

传输层：TCP、UDP

网络层：IP

数据链路层：以太网、WiFi

物理层：网线

### TCP

#### 四次挥手

客户端发送FIN包，表示它已经没有数据要发送了，进入FIN_WAIT_1状态

服务端收到FIN包后发送ACK包表示确认，服务端进入CLOSE_WAIT状态，客户端收到后进入FIN_WAIT_2状态

服务端也没有数据要发送之后会发送FIN包给客户端，进入LAST_ACK状态

客户端接收到FIN包后，发送ACK包给服务端表示确认，进入TIME_WAIT状态，持续2倍的最大报文生存时间（MSL，Maximum Segment Lifetime），以确保服务端收到ACK包，最终进入CLOSED状态

服务端在收到ACK包后，也进入CLOSED状态

#### 实现可靠传输

序列号、确认号应答、超时重传、快速重传、三次握手

#### 流量控制

滑动窗口机制：发送方通过接收方的窗口大小来动态调整自己的发送窗口大小

#### 拥塞控制

发送方维护一个拥塞窗口来限制发送的数据量

一开始慢启动，拥塞窗口指数增长达到阈值后进入拥塞避免阶段，开始线性增长，检测到丢包后（收到三次重复的确认号）快速重传，同时进入快速恢复状态，将拥塞窗口减半线性增长

#### 粘包

多个数据包被合成一个数据，接收方无法确定每个数据的边界，无法正确解析数据，通过应用层解决

#### Nagle算法

如果数据包小于TCP能发送的最大长度，而且不是连接报文、不是结束连接报文，还没有超时的话，先不发送，如果发出去的小数据包都被确认了就发送，不然等多个数据包一起发

#### TCP 和 UDP 区别

TCP是面向连接的，数据传输之前必须先建立连接，传输完还得断开连接

UDP是无连接的，可以直接传输数据

TCP可靠，丢包重传，UDP不可靠

TCP有流量控制和拥塞控制，UDP没有

UDP可以用于实时传输

### HTTP

#### 状态码

1XX：提示信息

2XX：成功

3XX：请求资源位置变了

4XX：客户端错误，请求报文有错

5XX：服务器错误，处理请求时发生错误

#### 字段

Host：请求服务器域名

Accept：客户端可以接受的数据格式

Accept-Encoding：客户端可以接受的数据压缩方法

Content-Encoding：服务器返回的数据压缩格式

Content-Length：服务器返回的数据长度

Content-Type：返回的数据格式

Connection：1.1兼容1.0指定connection为keep-alive使用长连接

#### 安全和幂等

安全：不改变服务器资源

幂等：重复请求结果相同

#### GET和POST

Get获取资源，Post提交数据

Get安全幂等，Post不安全不幂等

### HTTPS

#### 对称加密、非对称加密

对称加密：加密和解密使用相同密钥

非对称加密：公钥加密，私钥解密

#### 质数

除了1和本身之外没有其他因数的非0自然数

#### RSA非对称加密

数学原理：大质数乘积分解回原始质数因子困难

随机选择两个大素数p、q，计算乘积n=p·q，计算乘积的欧拉函数(p-1)(q-1)

选择一个整数e，大于1并且小于欧拉函数与其互质

计算e的模反元素d，d和e的乘积模欧拉函数为1

公钥：（e，n）：C=M^e^^^mod n

私钥：（d，n）：M=C^d^ mod n

#### SSL/TLS

Secure Sockets Layer，安全套接层，安全传输协议，后来标准化成Transport Layer Security

#### 密码套件

密钥交换算法+签名算法+对称加密算法+摘要算法

#### 数字证书

证书认证机构给合法的服务器发放的用来认证公钥持有者可信身份

#### SSL/TLS四次握手

客户端向服务器发送TLS版本号、支持的密码套件列表和一个随机数

服务器收到返回确认支持的TLS版本号，选择的密码套件和一个随机数，还会发送数字证书

客户端验证证书可信后生成一个随机数用公钥加密发给服务器

服务器用私钥解密得到该随机数，双方根据三个随机数生成会话密钥，后续采用对称加密通信

最后客户端会发送一个经过会话密钥加密的摘要信息让服务器验证，服务器验证后同样会发一个经过会话密钥加密的摘要信息让客户端验证，双方都确认过没问题后，可以开始加密通信
